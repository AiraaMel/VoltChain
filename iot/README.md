# VoltChain IoT

Implementations for IoT devices that collect energy data and send it to the VoltChain platform.

## Status

Under development — this folder will be implemented in the future.

## Supported Devices

### ESP32 (Primary)
- Microcontroller: ESP32-S3 or ESP32-C3
- Connectivity: Built-in WiFi
- Sensors: Energy, voltage, current meters
- Protocol: HTTP POST with HMAC authentication

### Other Microcontrollers
- Arduino with WiFi module
- Raspberry Pi for advanced prototypes
- STM32 for industrial applications

## Communication Protocol

### HMAC Authentication
```cpp
// Example C++ implementation
String message = deviceId + "." + timestamp + "." + tsDevice + "." + energyKwh;
String signature = hmacSha256(deviceSecret, message);
```

### HTTP Headers
```cpp
http.addHeader("x-device-id", deviceId);
http.addHeader("x-timestamp", timestamp);
http.addHeader("x-signature", signature);
http.addHeader("Content-Type", "application/json");
```

### JSON Payload
```json
{
  "ts_device": "2024-01-01T12:00:00Z",
  "energy_generated_kwh": 1.5,
  "voltage_v": 220.0,
  "current_a": 6.8,
  "frequency_hz": 60.0
}
```

## Planned Structure

```
iot/
├── esp32/                    # ESP32 code
│   ├── src/
│   │   ├── main.cpp         # Main program
│   │   ├── sensors/         # Sensor reading
│   │   ├── wifi/            # WiFi configuration
│   │   ├── crypto/          # HMAC implementation
│   │   └── api/             # Backend communication
│   ├── lib/                 # External libraries
│   ├── platformio.ini       # PlatformIO config
│   └── README.md
├── arduino/                  # Arduino code
├── raspberry-pi/            # Python scripts for RPi
├── stm32/                   # STM32 code
├── schematics/              # Electrical diagrams
├── 3d-models/               # 3D print models
└── docs/                    # Technical documentation
```

## Sensors and Measurements

### Energy Meter
- ACS712: AC current sensor
- ZMPT101B: Voltage transformer
- PZEM-004T: Complete energy meter

### Measured Parameters
- Energy generated: kWh (kilowatt-hour)
- Voltage: V (volts)
- Current: A (amperes)
- Frequency: Hz (hertz)

### Calibration
- Correction factors per sensor
- Reading validation
- Filters for electrical noise

## Device Configuration

### WiFi
```cpp
// Example web interface configuration
const char* ssid = "Your_WiFi_Network";
const char* password = "your_password";
```

### Backend
```cpp
// Backend endpoint
const char* serverUrl = "http://localhost:8080/v1/ingest";
```

### Credentials
```cpp
// Device ID and secret (generated by backend)
const char* deviceId = "device-uuid";
const char* deviceSecret = "base64-secret-key";
```

## ESP32 Example Code

### Basic Structure
```cpp
#include <WiFi.h>
#include <HTTPClient.h>
#include <ArduinoJson.h>

void setup() {
  Serial.begin(115200);
  setupWiFi();
  setupSensors();
}

void loop() {
  if (WiFi.status() == WL_CONNECTED) {
    EnergyReading reading = readEnergyData();
    sendToBackend(reading);
  }
  delay(30000); // Send every 30 seconds
}
```

### Sensor Reading
```cpp
EnergyReading readEnergyData() {
  EnergyReading reading;
  reading.timestamp = getCurrentTimestamp();
  reading.voltage = readVoltage();
  reading.current = readCurrent();
  reading.frequency = readFrequency();
  reading.energy = calculateEnergy(reading.voltage, reading.current);
  return reading;
}
```

## Security

### Authentication
- HMAC-SHA256: Sign all messages
- Timestamp: Validate within a 30s window
- Device secret: Unique per device

### Data Protection
- TLS/HTTPS: Encrypted communication
- Validation: Integrity checks
- Rate limiting: Control send frequency

## Monitoring and Debug

### Logs
- Serial output for debugging
- LED status for visual indicators
- Web interface for configuration

### Telemetry
- Connection status
- WiFi signal quality
- Communication errors
- Sending statistics

## Next Steps

1. Implement base code for ESP32
2. Create sensor library
3. Implement HMAC protocol
4. Develop configuration interface
5. Create hardware documentation
6. Implement OTA updates
7. Add support for other microcontrollers
8. Create automated tests
9. Develop calibration tools
